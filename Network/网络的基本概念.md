# 1. 网络
## 什么是网络
### IEEE标准规范
> Institute of Electrical and Electronic Engineers
> 802.3

## 计算机网络组成组件
- 节点(node): 节点主要是具有网络地址(IP)的设备的统称.
- 服务器主机(server)
- 工作站(workstation)或客户端(client)
- 网卡(Network Interface Card, NIC):主要用于提供网络连接, 目前大都使用具有RJ-45接口的以太网卡. 一般节点上具有一个以上的网卡, 以实现网络连接的功能
- 网络接口: loopback(lo)
- 网络形态或拓扑(topology)
- 网关(gateway):具有两个以上的网络接口, 可以连接两个以上不同的网段的设备, 例如IP路由器.


## 计算机网络协议: OSI七层协议
### OSI(Open System Interconnection)
每一层次只认识对方的同一层次的数据
打包包裹和拆包裹的过程

1. 应用层(Application Layer):
2. 表示层(Presentation Layer): 主要操作是将本地端应用程序的数据格式转换(或重新编码)称为网络的标准格式, 然后交给下面的传输层等的协议来进行处理
3. 会话层(Session Layer): 是确定网络服务器建立连接的确认
4. 传输层(Transport Layer): TCP 判断数据包是否可以正确的到达目标
5. 网络层(Network Layer): IP(Internet Protocol) 目的地路由(route)
6. 数据链路层(Data-Link Layer)
  - 偏软件介质部分: 有逻辑链接层(Logical Link Control, LLC)所控制. 主要在多任务处理来自上层的数据包数据(packet)并转成MAC的格式, 负责的工作包括信息交换, 流量控制, 失误问题的处理等
  - 偏硬件介质部分: 负责MAC(Madia Access Control), 称这个数据包裹为 **MAC数据帧(frame)**, MAC是网络接口设备所能处理的主要数据包裹, 这也是最终被物理层编码称比特流的数据. 使用IEEE802.3以太网络协议
7. 物理层(Physical Layer):

### 计算机网络协议: TCP/IP
1. 应用层(OSI的1,2,3)
2. 传输层(OSI的4)
3. 网络层(OSI的5)
4. 网络接口层(OSI的6,7): IP会依据**CSMA/CD**的标准, 封装到**MAC数据帧**中, 并基于MAC帧头, 再转成比特流后, 利用传输介质发送到远程主机上


# 2. TCP/IP 的网络接口层的相关协议
## 以太网络的传输协议: **CSMA/CD**
### CSMA/CD(Carrier Sense Multiple Access with Collision Detection)
> 为IEEE802.3的标准

### 集线器(hub)
> 集线器是一种网络共享介质设备
网络**共享**介质总在单一时间内, 仅能被一台主机所使用 (比喻:十字路口)
不同于交换器, 交换器是不共享的

传输会有以下流程:
1. 监听介质使用情况(Carrier Sense)
2. 多点传输(Multiple Access):
    数据会在某些情况下会被发给不是目标主机的主机
3. 冲突检测(Collision Detection)

标准的数据帧在网卡与其他以太网媒体一次只能传输1500bytes, 如果大于这个的文件会被拆分成多个小数据包

即使只有一台主机在使用网络媒体时, 这部主机每发送一个数据包前也需要等待一段时间(96 bit time).

## MAC的封装格式
CSMA/CD发送出去的数据帧, 就是MAC. **MAC可以比作一个在网线上传递的包裹, 而这个包裹是网络硬件上面传输数据的最小单位**
数据帧上面有两个很重要的数据: **目标与来源的网卡卡号**, 因此网卡卡号又简称**MAC地址**

### MAC数据帧(以太帧)结构:
1. 前导码(Layer)
2. MAC目标地址(MAC destination)
3. MAC源地址(MAC source)
4. 长度指示
5. LLC数据 负载(Payload)
6. 帧效验序列(Frame  check sequence)
一个32位循环冗余校验码，以便验证帧数据是否被损坏


在这个MAC的传送中, 尽在局域网内生效, 如果跨过不同的子网, 那么来源与目的的硬件地址就会跟着变, 因为已经变成了不同网卡之间的交流

## MTU(最大传输单位)
> Maximum Transmission unit

## 集线器,交换器与相关机制
集线器(Hub)与交换器(Switch)最大的差异在于交换器内有一个特别的内存, 这个内存可以记录每个 **Switch Port**与其连接的PC的MAC地址(记录在MAC Address Table里, 将Port和MAC对应起来), 所以当来自Switch两端的PC要互传数据时, 每个数据帧将直接通过交换机的内存数据而传送到目标主机上(集线器是多点传输)

### 交换器
> **不是共享设备**, 每个端口(port)都有独立的带宽

### 全双工/半双工(full-duplex/half-duplex)

# 3. TCP/IP的网络层相关数据包与数据
## IP数据包的封装
IP的袋子必须要放在MAC袋子当中

## IP的种类与取得方式
- Public IP:公共IP
- Private IP:私有IP
  - 私有IP的路由信息不能对外散播(只能存在内部网络)
  - 使用私有IP作为来源或目的地址的数据包, 不能通过Internet来传送
  - 关于私有IP的参考纪录(如DNS), 只能限于内部网络使用

### NAT
> Network Address Transfer
> 通过IP伪装, 使私有IP也能连上Internet

### 子网划分
同一个网段太多的计算机会影响效率, 因为你会接到其他很多计算机的广播(CSMA/CD的原因), 所以要进行子网划分

划分方法:
Host_ID可以拿来当做Net_ID
例如拿一位Host_ID来做Net_ID, Netmask就变成 255.255.255.128(11111111.11111111.11111111.10000000)
每个子网有不同Broadcast IP(广播地址), Network IP(网段地址)

### 无类别域间路由(CIDR)
> Classless Interdomain Routing
事实上, 由于网络细分的情况太严重, 为了担心路由信息过大而导致网络效率不佳, 某些特殊情况下, 反而是将Net_ID借用来作为Host_ID, 这样就能将多个网络写成一个了.
但是如果借用的过程可能会打破原本IP代表等级的方式, 这就叫CIDR
通常Network/Netmask的写法就是CIDR的写法

## 路由概念
每台主机都有自己的"路由表"

不在同一个网络的通信过程:
1. 查询IP数据包的目标IP地址
2. 查询是否位于本机所在的网络路由表中
如果发现目标IP和本机IP的Net_ID相同时, 通过局域网传送数据
3. 查询默认路由(Default Gateway)
如果不在同一网络, 本机会分析路由表当中是否有其他相符合的路由设置, 如果没有的话, 就直接将该IP数据包从到默认路由器(Default Gateway)去.
4. 送出数据包至 Default Gateway 后, 不理会数据包流向
本机不理会接下来的工作, 作为默认路由的服务器会分析路由信息, .....

Internet上面的路由不是静态的

### 网关/路由器
功能就是负责不同网络之间的数据包传递(IP Forwarding), 由于路由器具有IP Forwarding的功能, 并且具有管理路由的能力, 所以可以将来自不同网络之间的数据包进行传递.
**主机与主机配置的Gateway一定要在同一网段内**

## 观察主机路由 Route
命令`route [-n]`
- 要传送的数据包在路由规则里面: 就会直接以路由规则上写的那个网络接口(Use Iface)来传送出去, 而不通过Gateway
- 要传送的数据包不在路由规则里面: 会通过几乎每一台主机都会有的一个**Default Gateway**来传递

## IP与MAC: **网络接口层**的ARP与RARP协议
IP和MAC有着一定的关联性: 因为Internet上用的是IP, 而到了局域网, 传递数据的是以太网, 以太网主要是用网卡卡号(MAC)
### ARP协议
> Address Resolution Protocol(网络地址解析) 协议
要知道IP配置于哪张以太网卡上, 就要主机对整个局域网发送出ARP数据包, 对方收到ARP数据包后, 会返回它的MAC地址给主机(仅仅给主机. 通过数据帧上的Sender MAC Address来送回去), 主机知道了对方的网卡就能够开始传递数据了
### RARP
> Revers Address Resolution Protocol(反向网络地址解析) 协议

## ICMP协议
> Internet Control Message Protocal 因特网信息控制协议
ICMP数据包是一个错误检测与报告的机制, 最大的功能就是可以确保我们网络的连接状态与连接的正确性
ICMP数据包也是**网络层**的重要数据包之一

ICMP是通过IP数据包来进行数据传送的. 因为在Internet上面有传输能力的就是IP数据包了

# TCP/IP的传输层相关数据包与数据


<br/><br/>reference list:
- [鸟哥的Linux私房菜-服务器架设篇]()
